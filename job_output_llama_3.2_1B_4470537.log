/mnt/parscratch/users/aca22yn/anaconda/envs/prune_llm/lib/python3.9/site-packages/transformers/utils/hub.py:128: FutureWarning: Using `TRANSFORMERS_CACHE` is deprecated and will be removed in v5 of Transformers. Use `HF_HOME` instead.
  warnings.warn(
/mnt/parscratch/users/aca22yn/anaconda/envs/prune_llm/lib/python3.9/site-packages/transformers/models/auto/auto_factory.py:471: FutureWarning: The `use_auth_token` argument is deprecated and will be removed in v5 of Transformers. Please use `token` instead.
  warnings.warn(
torch 2.5.1
transformers 4.46.3
accelerate 1.1.1
# of gpus:  1
Script started successfully.
loading llm model google/gemma-2-9b
Downloading shards:   0%|          | 0/8 [00:00<?, ?it/s]Downloading shards:  12%|█▎        | 1/8 [01:55<13:28, 115.44s/it]Downloading shards:  25%|██▌       | 2/8 [03:53<11:40, 116.83s/it]Downloading shards:  38%|███▊      | 3/8 [05:51<09:47, 117.41s/it]Downloading shards:  50%|█████     | 4/8 [07:48<07:49, 117.32s/it]Downloading shards:  62%|██████▎   | 5/8 [09:46<05:52, 117.46s/it]Downloading shards:  75%|███████▌  | 6/8 [11:44<03:55, 117.65s/it]Downloading shards:  88%|████████▊ | 7/8 [13:43<01:58, 118.13s/it]Downloading shards: 100%|██████████| 8/8 [14:40<00:00, 98.70s/it] Downloading shards: 100%|██████████| 8/8 [14:40<00:00, 110.06s/it]
Loading checkpoint shards:   0%|          | 0/8 [00:00<?, ?it/s]Loading checkpoint shards:  12%|█▎        | 1/8 [00:01<00:12,  1.76s/it]Loading checkpoint shards:  25%|██▌       | 2/8 [00:03<00:10,  1.67s/it]Loading checkpoint shards:  38%|███▊      | 3/8 [00:05<00:08,  1.66s/it]Loading checkpoint shards:  50%|█████     | 4/8 [00:06<00:06,  1.63s/it]Loading checkpoint shards:  62%|██████▎   | 5/8 [00:08<00:04,  1.63s/it]Loading checkpoint shards:  75%|███████▌  | 6/8 [00:09<00:03,  1.62s/it]Loading checkpoint shards:  88%|████████▊ | 7/8 [00:11<00:01,  1.62s/it]Loading checkpoint shards: 100%|██████████| 8/8 [00:12<00:00,  1.36s/it]Loading checkpoint shards: 100%|██████████| 8/8 [00:12<00:00,  1.53s/it]
Model loaded successfully.
Tokenizer loaded successfully.
use device  cuda:0
Starting pruning with method: sparsegpt
Starting ...
Generating train split: 0 examples [00:00, ? examples/s]Generating train split: 4435 examples [00:00, 44250.45 examples/s]Generating train split: 13602 examples [00:00, 68221.80 examples/s]Generating train split: 22590 examples [00:00, 74930.11 examples/s]Generating train split: 32053 examples [00:00, 79432.48 examples/s]Generating train split: 41546 examples [00:00, 81902.29 examples/s]Generating train split: 50510 examples [00:00, 82164.80 examples/s]Generating train split: 59531 examples [00:00, 82496.58 examples/s]Generating train split: 68750 examples [00:00, 82509.94 examples/s]Generating train split: 77743 examples [00:00, 82602.53 examples/s]Generating train split: 86966 examples [00:01, 82981.23 examples/s]Generating train split: 95787 examples [00:01, 82504.06 examples/s]Generating train split: 104859 examples [00:01, 82721.29 examples/s]Generating train split: 113857 examples [00:01, 82384.08 examples/s]Generating train split: 122789 examples [00:01, 82280.95 examples/s]Generating train split: 132051 examples [00:01, 83093.21 examples/s]Generating train split: 141177 examples [00:01, 83188.50 examples/s]Generating train split: 150440 examples [00:01, 83571.35 examples/s]Generating train split: 159772 examples [00:01, 84400.82 examples/s]Generating train split: 168803 examples [00:02, 83542.71 examples/s]Generating train split: 177746 examples [00:02, 82832.54 examples/s]Generating train split: 186637 examples [00:02, 82158.91 examples/s]Generating train split: 195882 examples [00:02, 82372.54 examples/s]Generating train split: 204917 examples [00:02, 81926.02 examples/s]Generating train split: 214014 examples [00:02, 81861.16 examples/s]Generating train split: 223006 examples [00:02, 81907.31 examples/s]Generating train split: 232246 examples [00:02, 82160.37 examples/s]Generating train split: 241218 examples [00:02, 82326.95 examples/s]Generating train split: 250396 examples [00:03, 82400.46 examples/s]Generating train split: 259470 examples [00:03, 82889.14 examples/s]Generating train split: 268486 examples [00:03, 82645.28 examples/s]Generating train split: 277868 examples [00:03, 83221.90 examples/s]Generating train split: 286955 examples [00:03, 83659.27 examples/s]Generating train split: 295901 examples [00:03, 82014.22 examples/s]Generating train split: 304853 examples [00:03, 82098.46 examples/s]Generating train split: 314057 examples [00:03, 82341.17 examples/s]Generating train split: 323150 examples [00:03, 82640.97 examples/s]Generating train split: 332325 examples [00:04, 82647.76 examples/s]Generating train split: 341256 examples [00:04, 82337.42 examples/s]Generating train split: 350356 examples [00:04, 82331.65 examples/s]Generating train split: 356317 examples [00:04, 81915.64 examples/s]
Generating validation split: 0 examples [00:00, ? examples/s]Generating validation split: 9120 examples [00:00, 80048.16 examples/s]Generating validation split: 18229 examples [00:00, 80416.23 examples/s]Generating validation split: 27647 examples [00:00, 82100.28 examples/s]Generating validation split: 36991 examples [00:00, 83669.35 examples/s]Generating validation split: 45576 examples [00:00, 84356.43 examples/s]Generating validation split: 45576 examples [00:00, 83024.68 examples/s]
Ready.
0 self_attn.q_proj
Pruning ...
0 self_attn.k_proj
Pruning ...
0 self_attn.v_proj
Pruning ...
0 self_attn.o_proj
Pruning ...
0 mlp.gate_proj
Pruning ...
0 mlp.up_proj
Pruning ...
0 mlp.down_proj
Pruning ...
1 self_attn.q_proj
Pruning ...
1 self_attn.k_proj
Pruning ...
1 self_attn.v_proj
Pruning ...
1 self_attn.o_proj
Pruning ...
1 mlp.gate_proj
Pruning ...
1 mlp.up_proj
Pruning ...
1 mlp.down_proj
Pruning ...
2 self_attn.q_proj
Pruning ...
2 self_attn.k_proj
Pruning ...
2 self_attn.v_proj
Pruning ...
2 self_attn.o_proj
Pruning ...
2 mlp.gate_proj
Pruning ...
2 mlp.up_proj
Pruning ...
2 mlp.down_proj
Pruning ...
3 self_attn.q_proj
Pruning ...
3 self_attn.k_proj
Pruning ...
3 self_attn.v_proj
Pruning ...
3 self_attn.o_proj
Pruning ...
3 mlp.gate_proj
Pruning ...
3 mlp.up_proj
Pruning ...
3 mlp.down_proj
Pruning ...
4 self_attn.q_proj
Pruning ...
4 self_attn.k_proj
Pruning ...
4 self_attn.v_proj
Pruning ...
4 self_attn.o_proj
Pruning ...
4 mlp.gate_proj
Pruning ...
4 mlp.up_proj
Pruning ...
4 mlp.down_proj
Pruning ...
5 self_attn.q_proj
Pruning ...
5 self_attn.k_proj
Pruning ...
5 self_attn.v_proj
Pruning ...
5 self_attn.o_proj
Pruning ...
5 mlp.gate_proj
Pruning ...
5 mlp.up_proj
Pruning ...
5 mlp.down_proj
Pruning ...
6 self_attn.q_proj
Pruning ...
6 self_attn.k_proj
Pruning ...
6 self_attn.v_proj
Pruning ...
6 self_attn.o_proj
Pruning ...
6 mlp.gate_proj
Pruning ...
6 mlp.up_proj
Pruning ...
6 mlp.down_proj
Pruning ...
7 self_attn.q_proj
Pruning ...
7 self_attn.k_proj
Pruning ...
7 self_attn.v_proj
Pruning ...
7 self_attn.o_proj
Pruning ...
7 mlp.gate_proj
Pruning ...
7 mlp.up_proj
Pruning ...
7 mlp.down_proj
Pruning ...
8 self_attn.q_proj
Pruning ...
8 self_attn.k_proj
Pruning ...
8 self_attn.v_proj
Pruning ...
8 self_attn.o_proj
Pruning ...
8 mlp.gate_proj
Pruning ...
8 mlp.up_proj
Pruning ...
8 mlp.down_proj
Pruning ...
9 self_attn.q_proj
Pruning ...
9 self_attn.k_proj
Pruning ...
9 self_attn.v_proj
Pruning ...
9 self_attn.o_proj
Pruning ...
9 mlp.gate_proj
Pruning ...
9 mlp.up_proj
Pruning ...
9 mlp.down_proj
Pruning ...
10 self_attn.q_proj
Pruning ...
10 self_attn.k_proj
Pruning ...
10 self_attn.v_proj
Pruning ...
10 self_attn.o_proj
Pruning ...
10 mlp.gate_proj
Pruning ...
10 mlp.up_proj
Pruning ...
10 mlp.down_proj
Pruning ...
11 self_attn.q_proj
Pruning ...
11 self_attn.k_proj
Pruning ...
11 self_attn.v_proj
Pruning ...
11 self_attn.o_proj
Pruning ...
11 mlp.gate_proj
Pruning ...
11 mlp.up_proj
Pruning ...
11 mlp.down_proj
Pruning ...
12 self_attn.q_proj
Pruning ...
12 self_attn.k_proj
Pruning ...
12 self_attn.v_proj
Pruning ...
12 self_attn.o_proj
Pruning ...
12 mlp.gate_proj
Pruning ...
12 mlp.up_proj
Pruning ...
12 mlp.down_proj
Pruning ...
13 self_attn.q_proj
Pruning ...
13 self_attn.k_proj
Pruning ...
13 self_attn.v_proj
Pruning ...
13 self_attn.o_proj
Pruning ...
13 mlp.gate_proj
Pruning ...
13 mlp.up_proj
Pruning ...
13 mlp.down_proj
Pruning ...
14 self_attn.q_proj
Pruning ...
14 self_attn.k_proj
Pruning ...
14 self_attn.v_proj
Pruning ...
14 self_attn.o_proj
Pruning ...
14 mlp.gate_proj
Pruning ...
14 mlp.up_proj
Pruning ...
14 mlp.down_proj
Pruning ...
15 self_attn.q_proj
Pruning ...
15 self_attn.k_proj
Pruning ...
15 self_attn.v_proj
Pruning ...
15 self_attn.o_proj
Pruning ...
15 mlp.gate_proj
Pruning ...
15 mlp.up_proj
Pruning ...
15 mlp.down_proj
Pruning ...
16 self_attn.q_proj
Pruning ...
16 self_attn.k_proj
Pruning ...
16 self_attn.v_proj
Pruning ...
16 self_attn.o_proj
Pruning ...
16 mlp.gate_proj
Pruning ...
16 mlp.up_proj
Pruning ...
16 mlp.down_proj
Pruning ...
17 self_attn.q_proj
Pruning ...
17 self_attn.k_proj
Pruning ...
17 self_attn.v_proj
Pruning ...
17 self_attn.o_proj
Pruning ...
17 mlp.gate_proj
Pruning ...
17 mlp.up_proj
Pruning ...
17 mlp.down_proj
Pruning ...
18 self_attn.q_proj
Pruning ...
18 self_attn.k_proj
Pruning ...
18 self_attn.v_proj
Pruning ...
18 self_attn.o_proj
Pruning ...
18 mlp.gate_proj
Pruning ...
18 mlp.up_proj
Pruning ...
18 mlp.down_proj
Pruning ...
19 self_attn.q_proj
Pruning ...
19 self_attn.k_proj
Pruning ...
19 self_attn.v_proj
Pruning ...
19 self_attn.o_proj
Pruning ...
19 mlp.gate_proj
Pruning ...
19 mlp.up_proj
Pruning ...
19 mlp.down_proj
Pruning ...
20 self_attn.q_proj
Pruning ...
20 self_attn.k_proj
Pruning ...
20 self_attn.v_proj
Pruning ...
20 self_attn.o_proj
Pruning ...
20 mlp.gate_proj
Pruning ...
20 mlp.up_proj
Pruning ...
20 mlp.down_proj
Pruning ...
21 self_attn.q_proj
Pruning ...
21 self_attn.k_proj
Pruning ...
21 self_attn.v_proj
Pruning ...
21 self_attn.o_proj
Pruning ...
21 mlp.gate_proj
Pruning ...
21 mlp.up_proj
Pruning ...
21 mlp.down_proj
Pruning ...
22 self_attn.q_proj
Pruning ...
22 self_attn.k_proj
Pruning ...
22 self_attn.v_proj
Pruning ...
22 self_attn.o_proj
Pruning ...
22 mlp.gate_proj
Pruning ...
22 mlp.up_proj
Pruning ...
22 mlp.down_proj
Pruning ...
23 self_attn.q_proj
Pruning ...
23 self_attn.k_proj
Pruning ...
23 self_attn.v_proj
Pruning ...
23 self_attn.o_proj
Pruning ...
23 mlp.gate_proj
Pruning ...
23 mlp.up_proj
Pruning ...
23 mlp.down_proj
Pruning ...
24 self_attn.q_proj
Pruning ...
24 self_attn.k_proj
Pruning ...
24 self_attn.v_proj
Pruning ...
24 self_attn.o_proj
Pruning ...
24 mlp.gate_proj
Pruning ...
24 mlp.up_proj
Pruning ...
24 mlp.down_proj
Pruning ...
25 self_attn.q_proj
Pruning ...
25 self_attn.k_proj
Pruning ...
25 self_attn.v_proj
Pruning ...
25 self_attn.o_proj
Pruning ...
25 mlp.gate_proj
Pruning ...
25 mlp.up_proj
Pruning ...
25 mlp.down_proj
Pruning ...
26 self_attn.q_proj
Pruning ...
26 self_attn.k_proj
Pruning ...
26 self_attn.v_proj
Pruning ...
26 self_attn.o_proj
Pruning ...
26 mlp.gate_proj
Pruning ...
26 mlp.up_proj
Pruning ...
26 mlp.down_proj
Pruning ...
27 self_attn.q_proj
Pruning ...
27 self_attn.k_proj
Pruning ...
27 self_attn.v_proj
Pruning ...
27 self_attn.o_proj
Pruning ...
27 mlp.gate_proj
Pruning ...
27 mlp.up_proj
Pruning ...
27 mlp.down_proj
Pruning ...
28 self_attn.q_proj
Pruning ...
28 self_attn.k_proj
Pruning ...
28 self_attn.v_proj
Pruning ...
28 self_attn.o_proj
Pruning ...
28 mlp.gate_proj
Pruning ...
28 mlp.up_proj
Pruning ...
28 mlp.down_proj
Pruning ...
29 self_attn.q_proj
Pruning ...
29 self_attn.k_proj
Pruning ...
29 self_attn.v_proj
Pruning ...
29 self_attn.o_proj
Pruning ...
29 mlp.gate_proj
Pruning ...
29 mlp.up_proj
Pruning ...
29 mlp.down_proj
Pruning ...
30 self_attn.q_proj
Pruning ...
30 self_attn.k_proj
Pruning ...
30 self_attn.v_proj
Pruning ...
30 self_attn.o_proj
Pruning ...
30 mlp.gate_proj
Pruning ...
30 mlp.up_proj
Pruning ...
30 mlp.down_proj
Pruning ...
31 self_attn.q_proj
Pruning ...
31 self_attn.k_proj
Pruning ...
31 self_attn.v_proj
Pruning ...
31 self_attn.o_proj
Pruning ...
31 mlp.gate_proj
Pruning ...
31 mlp.up_proj
Pruning ...
31 mlp.down_proj
Pruning ...
32 self_attn.q_proj
Pruning ...
32 self_attn.k_proj
Pruning ...
32 self_attn.v_proj
Pruning ...
32 self_attn.o_proj
Pruning ...
32 mlp.gate_proj
Pruning ...
32 mlp.up_proj
Pruning ...
32 mlp.down_proj
Pruning ...
33 self_attn.q_proj
Pruning ...
33 self_attn.k_proj
Pruning ...
33 self_attn.v_proj
Pruning ...
33 self_attn.o_proj
Pruning ...
33 mlp.gate_proj
Pruning ...
33 mlp.up_proj
Pruning ...
33 mlp.down_proj
Pruning ...
34 self_attn.q_proj
Pruning ...
34 self_attn.k_proj
Pruning ...
34 self_attn.v_proj
Pruning ...
34 self_attn.o_proj
Pruning ...
34 mlp.gate_proj
Pruning ...
34 mlp.up_proj
Pruning ...
34 mlp.down_proj
Pruning ...
35 self_attn.q_proj
Pruning ...
35 self_attn.k_proj
Pruning ...
35 self_attn.v_proj
Pruning ...
35 self_attn.o_proj
Pruning ...
35 mlp.gate_proj
Pruning ...
35 mlp.up_proj
Pruning ...
35 mlp.down_proj
Pruning ...
36 self_attn.q_proj
Pruning ...
36 self_attn.k_proj
Pruning ...
36 self_attn.v_proj
Pruning ...
36 self_attn.o_proj
Pruning ...
36 mlp.gate_proj
Pruning ...
36 mlp.up_proj
Pruning ...
36 mlp.down_proj
Pruning ...
37 self_attn.q_proj
Pruning ...
37 self_attn.k_proj
Pruning ...
37 self_attn.v_proj
Pruning ...
37 self_attn.o_proj
Pruning ...
37 mlp.gate_proj
Pruning ...
37 mlp.up_proj
Pruning ...
37 mlp.down_proj
Pruning ...
38 self_attn.q_proj
Pruning ...
38 self_attn.k_proj
Pruning ...
38 self_attn.v_proj
Pruning ...
38 self_attn.o_proj
Pruning ...
38 mlp.gate_proj
Pruning ...
38 mlp.up_proj
Pruning ...
38 mlp.down_proj
Pruning ...
39 self_attn.q_proj
Pruning ...
39 self_attn.k_proj
Pruning ...
39 self_attn.v_proj
Pruning ...
39 self_attn.o_proj
Pruning ...
39 mlp.gate_proj
Pruning ...
39 mlp.up_proj
Pruning ...
39 mlp.down_proj
Pruning ...
40 self_attn.q_proj
Pruning ...
40 self_attn.k_proj
Pruning ...
40 self_attn.v_proj
Pruning ...
40 self_attn.o_proj
Pruning ...
40 mlp.gate_proj
Pruning ...
40 mlp.up_proj
Pruning ...
40 mlp.down_proj
Pruning ...
41 self_attn.q_proj
Pruning ...
41 self_attn.k_proj
Pruning ...
41 self_attn.v_proj
Pruning ...
41 self_attn.o_proj
Pruning ...
41 mlp.gate_proj
Pruning ...
41 mlp.up_proj
Pruning ...
41 mlp.down_proj
Pruning ...
Pruning completed.
******************************
layer 0 sparsity 0.500001
layer 1 sparsity 0.500001
layer 2 sparsity 0.500001
layer 3 sparsity 0.500001
layer 4 sparsity 0.500001
layer 5 sparsity 0.500001
layer 6 sparsity 0.500001
layer 7 sparsity 0.500001
layer 8 sparsity 0.500001
layer 9 sparsity 0.500001
layer 10 sparsity 0.500001
layer 11 sparsity 0.500001
layer 12 sparsity 0.500001
layer 13 sparsity 0.500002
layer 14 sparsity 0.500001
layer 15 sparsity 0.500002
layer 16 sparsity 0.500001
layer 17 sparsity 0.500001
layer 18 sparsity 0.500001
layer 19 sparsity 0.500001
layer 20 sparsity 0.500001
layer 21 sparsity 0.500001
layer 22 sparsity 0.500001
layer 23 sparsity 0.500001
layer 24 sparsity 0.500001
layer 25 sparsity 0.500001
layer 26 sparsity 0.500001
layer 27 sparsity 0.500001
layer 28 sparsity 0.500001
layer 29 sparsity 0.500001
layer 30 sparsity 0.500001
layer 31 sparsity 0.500001
layer 32 sparsity 0.500001
layer 33 sparsity 0.500001
layer 34 sparsity 0.500001
layer 35 sparsity 0.500001
layer 36 sparsity 0.500001
layer 37 sparsity 0.500001
layer 38 sparsity 0.500001
layer 39 sparsity 0.500002
layer 40 sparsity 0.500001
layer 41 sparsity 0.500001
sparsity sanity check 0.5000
******************************
Starting perplexity evaluation on wikitext.
evaluating on wikitext2
Generating test split:   0%|          | 0/4358 [00:00<?, ? examples/s]Generating test split:  23%|██▎       | 1000/4358 [00:00<00:00, 9671.76 examples/s]Generating test split: 100%|██████████| 4358/4358 [00:00<00:00, 39430.54 examples/s]
Generating train split:   0%|          | 0/36718 [00:00<?, ? examples/s]Generating train split: 100%|██████████| 36718/36718 [00:00<00:00, 624169.99 examples/s]
Generating validation split:   0%|          | 0/3760 [00:00<?, ? examples/s]Generating validation split: 100%|██████████| 3760/3760 [00:00<00:00, 495727.63 examples/s]
Loaded 2 samples in testloader.
nsamples 35
sample 0
wikitext perplexity 125.17884063720703
